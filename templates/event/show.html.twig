{% extends 'base.html.twig' %}

{% block title %}
    {{ event.title }} - Event Details
{% endblock %}

{% block body %}

    <div class="event-detail-wrapper">

        <div class="event-detail-top">
            <div>
                <h2>{{ event.title|upper }}</h2>
                <h3>{{ event.datetimeStart|date("d/m/Y H:i") }}</h3>
            </div>
            <h3>Created by {{ event.creator.username }}</h3>
        </div>

        <div class="event-detail-main">
            <p class="event-detail-description">
                {{ event.description}}
            </p>

            <figure class="event-img">
                {% if event.image %}
                    <img src="{{ asset('img/event/' ~ event.image) }}" alt="">
                {% else %}
                    <img src="{{ asset('img/partials/image_not_found.png') }}" alt="">
                {% endif %}
            </figure>
        </div>

        <div class="event-detail-bottom">
            <div class="users">
                <h3><i class="fa-solid fa-user"></i> {{ event.users | length }} users</h3>
                {% for user in event.users %}
                    <h4>{{ user.username }}</h4>
                {% endfor %}

                {% if event.isPrivate %}
                    {% if app.user == event.creator %}
                        {% if requests | length > 0 %}
                            <h3>Pending Requests</h3>
                            {% for request in requests %}
                                <div class="request">
                                    <h4>{{ request.user.username }}</h4>
                                    <a class="btn" href="{{ path('event_accept_request', {id: event.id, title: event.title, requestUser: request.user.id}) }}">Accept request</a>
                                    <a class="btn" href="{{ path('event_deny_request', {id: event.id, title: event.title, requestUser: request.user.id}) }}">Deny request</a>

                                </div>

                            {% endfor %}
                        {% endif %}
                    {% endif %}
                {% endif %}
            </div>

            <div class="btns">
                {% if app.user != event.creator %}
                    {% if isJoined %}
                        <a class="btn event-detail-btn event-leave-btn" href="{{ path('event_leave', {id: event.id, title: event.title}) }}">
                            Joined <i class="fa-solid fa-check"></i>
                        </a>
                    {% else %}
                        {% if event.isPrivate %}
                            {% if app.user.hasEventRequest(event) %}
                                <a class="btn event-detail-btn" href="{{ path('event_cancel_request', {id: event.id, title: event.title}) }}">Cancel request</a>
                            {% else %}
                                <a class="btn event-detail-btn" href="{{ path('event_request', {id: event.id, title: event.title}) }}">Send request</a>
                            {% endif %}
                        {% else %}
                            <a class="btn event-detail-btn" href="{{ path('event_join', {id: event.id, title: event.title}) }}">Join</a>
                        {% endif %}
                    {% endif %}
                {% endif %}
                <a class="btn btn-secondary-detail event-detail-btn" href="">Share <i class="fa-solid fa-share-nodes"></i></a>
                {% if app.user == event.creator %}
                    <a class="btn btn-secondary-detail event-detail-btn" href="{{ path('event_edit', {id: event.id}) }}">Edit <i class="fa-solid fa-pen-to-square"></i></a>
                    <form method="post" action="{{ path('event_delete', {id: event.id}) }}" style="width: 100%;">
                        <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ event.id) }}">
                        <button type="submit" class="btn btn-delete-detail event-detail-btn" onclick="return confirm('Are you sure you want to delete this event?');">
                            Delete <i class="fa-regular fa-trash-can"></i>
                        </button>
                    </form>
                {% endif %}
            </div>
        </div>

    </div>

{% endblock %}

